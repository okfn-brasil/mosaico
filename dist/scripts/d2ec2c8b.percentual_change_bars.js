(function(){angular.module("fgvApp").filter("percentual",function(){var a;return a=function(a){var b,c;return b=Math.abs(a),c=b>100?0:b>10?1:2,a.toFixed(c).replace(".",",")},function(b){return a(100*b||0)+"%"}})}).call(this),function(){var a={}.hasOwnProperty;angular.module("fgvApp").directive("percentualChangeBars",["$q","openspending","routing",function(b,c,d){var e,f,g;return f=function(a){return a.reduce(function(a,b){return a[b.type]=b.id,a},{})},e=function(b){var c,d,e,f,g,h;g=100,f=0;for(h in b)a.call(b,h)&&(c=b[h],e=Math.abs(c.delta),e>f&&(f=e));d=function(a){return Math.abs(a*g/f)};for(h in b)a.call(b,h)&&(c=b[h],c.height=d(c.delta));return b},g=function(a,b){var d,e,g,h;return h=[6.15,5.87,8.33,7.19,8.23,6.97,5.35],e=f(b),delete e.year,g=[b[b.length-1].type,"year"],d=void 0,c.aggregate(e,g).then(function(b){var c,e,f,g,i,j,k,l,m,n,o,p;for(console.log(b.data.drilldown),d=function(){var a,c,d,e;for(d=b.data.drilldown,e=[],a=0,c=d.length;c>a;a++)g=d[a],e.push({label:g.year,value:g.amount});return e}(),d.sort(function(a,b){return parseInt(a.label)-parseInt(b.label)}),a.bars=d,f=[{key:"Percentual",bar:!0,values:[]}],j=k=0,n=d.length;n>k;j=++k)e=d[j],f[0].values.push([parseInt(e.label),e.value]);for(f.push({key:"IPCA",values:[]}),i=[1],j=l=o=d.length-2;1>=o?1>=l:l>=1;j=1>=o?++l:--l)i.push(i[d.length-j-2]*(1-h[j]/100));for(i=i.reverse(),j=m=0,p=i.length-1;p>=0?p>=m:m>=p;j=p>=0?++m:--m)console.log(d[j].value,d[j].value/i[j],i[j]),f[1].values.push([parseInt(d[j].label),d[j].value/i[j]]);return f[1].values.push([parseInt(d[d.length-1].label),d[d.length-1].value]),a.y2max=Math.max.apply(Math,function(){var a,b,d,e;for(d=f[1].values,e=[],a=0,b=d.length;b>a;a++)c=d[a],e.push(c[1]);return e}()),console.log("L",f),a.barsData=f})},{restrict:"E",templateUrl:"/views/partials/percentual_change_bars.html",scope:{year:"="},link:function(a){var b;return c.aggregate(void 0,["year"]).then(function(b){var c,d,e,f,g;for(d={},g=b.data.drilldown,e=0,f=g.length;f>e;e++)c=g[e],d[c.year]=c.amount;return a.totals=d}),b=function(){var b;return b=d.getBreadcrumb(),b&&a.totals?g(a,b,a.totals):void 0},a.$watch(d.getBreadcrumb,b,!0),a.$watch("totals",b)}}}])}.call(this);