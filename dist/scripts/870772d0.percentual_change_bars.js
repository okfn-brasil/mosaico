(function(){angular.module("fgvApp").filter("percentual",function(){var a;return a=function(a){var b,c;return b=Math.abs(a),c=b>100?0:b>10?1:2,a.toFixed(c).replace(".",",")},function(b){return a(100*b||0)+"%"}})}).call(this),function(){var a={}.hasOwnProperty;angular.module("fgvApp").directive("percentualChangeBars",["$q","openspending","routing",function(b,c,d){var e,f,g;return f=function(a){return a.reduce(function(a,b){return a[b.type]=b.id,a},{})},e=function(b){var c,d,e,f,g,h;g=100,f=0;for(h in b)a.call(b,h)&&(c=b[h],e=Math.abs(c.delta),e>f&&(f=e));d=function(a){return Math.abs(a*g/f)};for(h in b)a.call(b,h)&&(c=b[h],c.height=d(c.delta));return b},g=function(a,b){var d,e,g,h;return h=[6.15,5.87,8.33,7.19,8.23,6.97,5.35,5.35],e=f(b),delete e.year,g=[b[b.length-1].type,"year"],d=void 0,c.aggregate(e,g).then(function(b){var c,e,f,g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;if(o=Math.min.apply(Math,function(){var a,c,d,e;for(d=b.data.drilldown,e=[],a=0,c=d.length;c>a;a++)j=d[a],e.push(parseInt(j.year));return e}()),2006!==o)for(q=function(){var a,b;for(b=[],p=a=2006;o>=2006?o>=a:a>=o;p=o>=2006?++a:--a)b.push({year:""+p,amount:0});return b}(),y=b.data.drilldown,s=0,w=y.length;w>s;s++)p=y[s],q.push({year:p.year,amount:p.amount});else q=b.data.drilldown;for(d=function(){var a,b,c;for(c=[],a=0,b=q.length;b>a;a++)j=q[a],c.push({label:j.year,value:j.amount});return c}(),d.sort(function(a,b){return parseInt(a.label)-parseInt(b.label)}),a.bars=d,i=[{key:"OrÃ§amento Autorizado",bar:!0,values:[]}],l=t=0,x=d.length;x>t;l=++t)g=d[l],i[0].values.push([parseInt(g.label),g.value]);for(i.push({key:"IPCA",color:"#66458c",values:[]}),k=[1],l=u=z=d.length-2;0>=z?0>=u:u>=0;l=0>=z?++u:--u)k.push(k[d.length-l-2]*(1-h[l]/100));for(k=k.reverse(),l=v=0,A=k.length-2;A>=0?A>=v:v>=A;l=A>=0?++v:--v)i[1].values.push([parseInt(d[l].label),d[l].value/k[l]]);return i[1].values.push([parseInt(d[d.length-1].label),d[d.length-1].value]),m=Math.max.apply(Math,function(){var a,b,c,d;for(c=i[1].values,d=[],b=0,a=c.length;a>b;b++)f=c[b],d.push(f[1]);return d}()),n=Math.min.apply(Math,function(){var a,b,c,d;for(c=i[1].values,d=[],b=0,a=c.length;a>b;b++)f=c[b],d.push(f[1]);return d}()),c=Math.max.apply(Math,function(){var a,b,c,d;for(c=i[0].values,d=[],b=0,a=c.length;a>b;b++)f=c[b],d.push(f[1]);return d}()),e=Math.min.apply(Math,function(){var a,b,c,d;for(c=i[0].values,d=[],b=0,a=c.length;a>b;b++)f=c[b],d.push(f[1]);return d}()),a.ymin=Math.min(n,e),a.tooltipContent=function(a,b,c,d){return NumberHelpers.number_to_currency(d.point[1],{delimiter:".",separator:",",unit:"R$"})},r=""+Math.floor(a.ymin),a.ymin=parseFloat(r[0])*Math.pow(10,r.length-1),a.ymax=Math.max(m,c),a.barsData=i})},{restrict:"E",templateUrl:"/views/partials/percentual_change_bars.html",scope:{year:"="},link:function(a){var b;return c.aggregate(void 0,["year"]).then(function(b){var c,d,e,f,g;for(d={},g=b.data.drilldown,e=0,f=g.length;f>e;e++)c=g[e],d[c.year]=c.amount;return a.totals=d}),b=function(){var b;return b=d.getBreadcrumb(),b&&a.totals?g(a,b,a.totals):void 0},a.yAxisTickFormatFunction=function(){return"T"},a.$watch(d.getBreadcrumb,b,!0),a.$watch("totals",b)}}}])}.call(this);